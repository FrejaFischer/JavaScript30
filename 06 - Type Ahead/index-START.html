<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Type Ahead 游</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="icon" href="https://fav.farm/游댠" />
  </head>
  <body>
    <form class="search-form">
      <input type="text" class="search" placeholder="City or State" />
      <ul class="suggestions">
        <li>Filter for a city</li>
        <li>or a state</li>
      </ul>
    </form>
    <script>
      const endpoint = "https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json";

      const cities = [];

      fetch(endpoint) //f칮rst skal vi hente dataen (fetch). Det den giver os er et "promise". Ikke noget brugbart endnu, men den siger der nok skal kommer noget
        .then((blob) => blob.json()) //Dette kan kaldes en blob af informationer (derfor navnet blob, selvvalgt navn), men den ved ikke hvad for en data det er endnu (billede, tekst, musik mm.)
        //Derfor skal vi fort칝lle den det er json, hvor der her findes en metode: json(). Dette giver et nyt "promise".
        .then((data) => cities.push(...data));
      //Derfra skal vi igen g칮re en "then", hvor vi nu vil have den endelige data.
      //Denne data skal vi have ind i vores const variable. Dette g칮res ved at pushe den ind i. De tre prikker "spreed into" vores push metode og dette g칮r at vores array kommer direkte ind og ikke ind i en yderligere array

      //nu skal vi lave en funktion, der filtrere i vores data, ud fra hvad brugeren s칮ger p친 i s칮gefeltet:
      function findMatches(wordToMatch, cities) {
        return cities.filter((place) => {
          //her skal vi finde ud af om byen eller staten matcher der er s칮gt p친
          const regex = new RegExp(wordToMatch, "gi"); //Her laver vi en variable, der kan finde et match i ens s칮gning og data. 췂g췂 st친r for global, der g칮r at den kigger igennem hele den string i ens s칮gning. `i` st친r for insensitive og kan v칝re sensitiv overfor store og sm친 bogstaver.
          return place.city.match(regex) || place.state.match(regex); //Her s칮ger vi s친 i henholdsvis city og state holderne efter et match med vores s칮gning. || betyder "eller / or"
        });
      }

      function numberWithCommas(x) {
        return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
      }
      //denne funktion er direkte copy paste fra Wes Bos egen l칮sning. Den kan tage store numre om s칝tte punktummer i s친 de bliver lettere at l칝se. #copypastemuch

      function displayMatches() {
        const matchArray = findMatches(this.value, cities);
        // console.log(matchArray); Fang altid data'en f칮rst og se om der er hul igennem
        const html = matchArray
          .map((place) => {
            const regex = new RegExp(this.value, "gi");
            const cityName = place.city.replace(regex, `<span class="hl">${this.value}</span>`);
            const stateName = place.state.replace(regex, `<span class="hl">${this.value}</span>`);
            //her lave vi igen en variable, der kan finde et match i s칮gningen og data. Her bruger vi den dog til at kunne highlighte matchet mellem s칮gningen og data'en, b친de i by og stat.
            return `
          <li>
            <span class="name"> ${cityName}, ${stateName}</span>
            <span class="population"> ${numberWithCommas(place.population)}</span>
          </li>
          `;
          })
          .join("");
        // Her map'er vi igennem de resultater vi f친r i matchArray og skaber nyt html, hvori navn p친 by og state samt st칮rrelsen p친 byen bliver vist. Det sidste ".join("")" binder alle de forskellige resultater sammen til et array og ikke hver sit. Det ser forkert ud uden.
        suggestions.innerHTML = html;
        //og til sidst binder vi det nye html fast til suggestions, der allerede findes i det originale html
      }

      const searchInput = document.querySelector(".search");
      const suggestions = document.querySelector(".suggestions");

      searchInput.addEventListener("change", displayMatches);
      searchInput.addEventListener("keyup", displayMatches);
      //her bliver det alt sammen brugt ved eventlistener, der lytter til n친r der sker en 칝ndring + n친r 칠n knap er blevet trykket p친 i feltet. N친r dette sker k칮rer den displatMatches igennem og derved kommer hele maskineriet i gang
    </script>
  </body>
</html>
